<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        #app-container {
            background: #86ccf6;
        }
        [v-cloak] { display:none }
    </style>
    <link rel="stylesheet" href="/styles/vendor.css"/>
    <link rel="stylesheet" href="/styles/global.css"/>
</head>
<body>

    <div id="app-container">
        <div class="app-full-screen" v-cloak>
            <section v-for='map in maps' class="map-card" v-if="show">
                <h1>{{map.name}}</h1>
                <a class="button" :href='"./map.html#"+map.id'>Launch</a>
            </section>
        </div>
    </div>

    <!-- platform setup -->
    <script src="/scripts/data.min.js"></script>
    <script src="/scripts/apps.min.js"></script>
    <script>
        // database
        let db = new LD.Database(window.location.origin + '/gun')
        db.setup()

        // maps
        let vue = new LA.Vue({
            el: '#app-container',
            data: {
                maps: [],
                show: false
            }
        })

        // get data for maps
        db.get('pkg').map((v,k) => {
            if (v.name && v.version) {
                let id = [v.name,v.version].join('@')
              
                // for now, redirect to first valid package
                window.location = './map.html#'+id

                console.log("[package] verified package: " + id)
                db.get('pkg').get(v.name)
                    .get('organization')
                    .once((orgV,orgK) => {
                        let item = {
                            id: id,
                            name: v.name,
                            version: v.version,
                            org: orgV.name
                        }
                        vue.maps.push(item)


                    })
            }
            else {
                console.log("[package] missing name or version: " + k)
            }
        })
    </script>
</body>
</html>
